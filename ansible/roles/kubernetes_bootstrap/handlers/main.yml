---
- name: ArgoCD | pause to allow argocd to fully deploy
  ansible.builtin.pause:
    seconds: 150
  listen: pause for argocd
  tags:
    - kubernetes
    - kubernetes-bootstrap
    - argocd
  when:
    - ansible_facts['os_family'] == 'Debian'
    - inventory_hostname in groups['k8s_controllers']

- name: Core | pause to allow core-apps app to fully deploy
  ansible.builtin.pause:
    seconds: 150
  listen: pause for core-apps app
  tags:
    - kubernetes
    - kubernetes-bootstrap
    - core
  when:
    - ansible_facts['os_family'] == 'Debian'
    - inventory_hostname in groups['k8s_controllers']

- name: OpenEBS | apply /opt/homelab/kubernetes/core/openebs/ansible/cstor-pool-cluster.yaml
  ansible.builtin.command:
    chdir: /opt/homelab/kubernetes/core/openebs/ansible/
    cmd: kubectl apply -f /opt/homelab/kubernetes/core/openebs/ansible/cstor-pool-cluster.yaml
  listen: apply cstor-pool-cluster.yaml
  tags:
    - kubernetes
    - kubernetes-bootstrap
    - openebs
  when:
    - ansible_facts['os_family'] == 'Debian'
    - inventory_hostname in groups['k8s_controllers']

- name: OpenEBS | pause to allow the openebs storage cluster to fully provision
  ansible.builtin.pause:
    seconds: 150
  listen: pause for openebs storage cluster
  tags:
    - kubernetes
    - kubernetes-bootstrap
    - openebs
  when:
    - ansible_facts['os_family'] == 'Debian'
    - inventory_hostname in groups['k8s_controllers']

- name: OpenEBS | apply /opt/homelab/kubernetes/core/openebs/ansible/cstor-storage-class.yaml
  ansible.builtin.command:
    chdir: /opt/homelab/kubernetes/core/openebs/ansible/
    cmd: kubectl apply -f /opt/homelab/kubernetes/core/openebs/ansible/cstor-storage-class.yaml
  listen: apply cstor-storage-class.yaml
  tags:
    - kubernetes
    - kubernetes-bootstrap
    - openebs
  when:
    - ansible_facts['os_family'] == 'Debian'
    - inventory_hostname in groups['k8s_controllers']

- name: Infrastructure | pause to allow infrastructure-apps app to fully deploy
  ansible.builtin.pause:
    seconds: 150
  listen: pause for infrastructure-apps app
  tags:
    - kubernetes
    - kubernetes-bootstrap
    - infrastructure
  when:
    - ansible_facts['os_family'] == 'Debian'
    - inventory_hostname in groups['k8s_controllers']

- name: Apps | pause to allow apps-apps app to fully deploy
  ansible.builtin.pause:
    seconds: 150
  listen: pause for apps-apps app
  tags:
    - kubernetes
    - kubernetes-bootstrap
    - apps
  when:
    - ansible_facts['os_family'] == 'Debian'
    - inventory_hostname in groups['k8s_controllers']
