---
- name: Common | set variables
  ansible.builtin.include_vars: '{{ item }}'
  tags:
    - common
    - network
    - firewall
    - ntp
    - packages
    - auto-updates
    - users
  with_first_found:
    - "{{ ansible_facts['os_family'] }}.yml"
    - default.yml

- name: Common | populate service facts
  ansible.builtin.service_facts:
  tags:
    - common

# Network
- name: Network
  ansible.builtin.import_tasks: network.yml
  tags:
    - common
    - network

# Firewall
- name: Firewall
  ansible.builtin.include_tasks:
    file: firewall-{{ ansible_facts['os_family'] }}.yml
    apply:
      tags:
        - common
        - firewall

# NTP
- name: NTP
  ansible.builtin.import_tasks: ntp.yml
  tags:
    - common
    - ntp

# Packages
- name: Packages
  ansible.builtin.import_tasks: packages.yml
  tags:
    - common
    - packages

# Auto Updates
- name: Auto-updates
  ansible.builtin.include_tasks:
    file: auto-update-{{ ansible_facts['os_family'] }}.yml
    apply:
      tags:
        - common
        - auto-updates

# Users
- name: Users
  ansible.builtin.import_tasks: users.yml
  tags:
    - common
    - users

# Flush Handlers
- name: Common | flush handlers
  ansible.builtin.meta: flush_handlers
  tags:
    - common
